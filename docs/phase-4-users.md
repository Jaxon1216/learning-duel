# Phase 4：查看其他用户

## 目标

左侧栏显示所有用户列表，每人旁边显示总完成率。点击用户切换查看他们的路线和节点（只读）。

## 核心组件

### UserList — 用户列表侧边栏

- 显示所有注册用户
- 自己名字后有 "(我)" 标记
- 每人旁边显示总完成率（如 66.67%）
- 选中的用户高亮（黑底白字）
- 顶部有"登出"按钮

## 数据流

```
页面加载 → 获取所有 profiles
         → 获取所有 routes + route_nodes
         → 计算每人完成率
         → 渲染列表

点击用户 → 设置 viewingUserId
         → 加载该用户的 goals, routes, profile
         → 默认选中第一条路线
         → 加载路线节点
```

### 完成率计算逻辑

对每个用户：

1. 找到该用户的所有 routes
2. 找到这些 routes 下的所有 route_nodes
3. 完成率 = 已完成 / 总数 × 100

## isOwner 机制

页面上所有可编辑组件都有 `isOwner` 属性：

```tsx
const isOwner = currentUserId === viewingUserId
```

- `isOwner = true`：显示添加、删除、编辑按钮
- `isOwner = false`：隐藏所有操作，纯查看

这是**前端层**的保护。即使有人绕过前端，**RLS** 也会在数据库层拦住。

双重保险。

## 权限保证

- SELECT 所有表都是 `true`（所有人可查看所有人）
- INSERT/UPDATE/DELETE 都检查 `auth.uid() = user_id`

这就实现了：
> 看得见别人，改不了别人

## 验收标准

- [x] 左侧栏显示所有注册用户
- [x] 每人旁边有完成率
- [x] 点击别人，右侧显示他们的路线
- [x] 看别人时，没有添加/删除/编辑按钮
- [x] 点回自己，编辑功能恢复
